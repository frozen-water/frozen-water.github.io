---
layout: post
title: 삽질기록
date: 2025-09-28 18:43:14 +0900
categories: [Trouble]
tags: [ArgoCD,Kubernetes,Kafka]
---

### 🛠️ Spring-Kafka + ArgoCD + Kafka PVC 삽질 기록

### 1. Spring Boot + Kafka
- **문제**: bootstrap.servers 설정 안 잡혀서 `No resolvable bootstrap urls given` 에러 발생
- **원인**: 환경변수 전달 안 됨
- **해결**: values.yaml → `kafka.kafka.svc.cluster.local:9092` 로 지정

---

### 2. GitHub Actions
- **문제**: manifest repo 업데이트 시 push 권한 403
- **원인**: GITHUB_TOKEN 은 다른 repo push 권한 없음
- **해결**: PAT 만들어 `secrets.GH_PAT` 사용

---

### 3. ArgoCD Application
- **문제**: `Destination server missing` 에러
- **원인**: Application CR 잘못 작성
- **해결**:
  ```yaml
  destination:
    server: https://kubernetes.default.svc
    namespace: myapp
    ```

---

### 4. ArgoCD Sync 실패
- 문제: 소스 변경 후, push 했으나 argo가 감지하지 못함
- 원인: GitOps는 `values.yaml` 안의 tag 를 바꿔야 ArgoCD가 이미지 업데이트 인식

---

### **5. Kafka Helm 차트**

- **문제**: PodInitializing → PVC unbound → CrashLoopBackOff
- **원인**: KRaft 모드에서 PVC 꼬임
- **해결**:
```bash
$ kubectl delete pvc -n kafka -l app.kubernetes.io/name=kafka
```
- **교훈**: Kafka Helm 재설치 시 PVC 정리 필수

---

## **6. Spring Kafka Consumer**

- **문제**: Producer는 메시지 전송됨, Consumer는 메시지 안 읽음
- **원인 후보**:
  1. 기존 group offset
  2. Consumer 실행 전에 메시지 들어감
  3. Kafka CrashLoopBackOff 상태
- **해결**: consumer group-id 새로 지정 → 정상 consume
- **교훈**: 테스트할 땐 group-id 자주 바꿔보기
