---
layout: post
title: 2025-09-28-배포 자동화 정리
date: 2025-09-28 18:44:49 +0900
categories: [Summary]
tags: [Kubernetes,ArgoCD,Kafka,Github Actions]
---

### 📖 오늘 공부한 것 정리



### 1. ArgoCD 동작 방식

- ArgoCD는 **DockerHub 최신 상태를 보지 않음**

- GitOps 원칙 → Git repo 안의 values.yaml `image.tag` 만 신뢰

- 따라서 GitHub Actions에서:

1. Docker image 빌드 & push

2. manifest repo values.yaml 의 tag 업데이트 & push

3. ArgoCD sync



---



### 2. GitHub Actions & PAT

- `GITHUB_TOKEN`은 **현재 repo**만 쓰는 용도

- 다른 repo push 하려면 **PAT (Personal Access Token)** 필요

- 권한: `repo`, `workflow`, `write:packages` 정도 체크



---



### 3. Kafka in Kubernetes

- Bitnami Kafka Helm chart는 기본적으로 PVC를 생성

- PVC 남아 있으면 KRaft 초기화 실패 → CrashLoopBackOff

- 해결: Kafka 재설치 전 `kubectl delete pvc` 로 정리



---



### 4. Spring Kafka Consumer 동작

- `@KafkaListener` → group-id 로 offset 관리

- 기존 consumer group 은 offset 저장 → 이전 메시지 안 읽음

- `auto-offset-reset: earliest` 도 group 있으면 적용 안 됨

- **테스트 팁**: group-id 바꿔주면 처음부터 consume 가능



---



### 5. Minikube 네트워크

- `svc.cluster.local` → 클러스터 내부 Pod 간 통신

- `minikube service ... --url` → 로컬 PC에서 접속할 때 사용



---



### ✅ 핵심 교훈

1. GitOps = Git repo가 진짜 소스, DockerHub latest는 의미 없음

2. Kafka PVC는 재설치 전에 꼭 정리

3. Consumer는 group-id 따라 offset 다르게 동작

4. 외부 접근 vs 내부 접근 주소 구분
